<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="perfil.css">
</head>
<body>

     <header>
        <h2 id="welcomeMessage"></h2>
        <div>
            <a id="profileLink" href="tabla.html">Tablas</a>
            <img id="logoutIcon" src="logout.png" alt="Logout">
        </div>
    </header>

    <div class="profile-box">
        <h2>Perfil de Usuario</h2>
        <div class="profile-image">
            <img id="profileImage" src="default-profile.png" alt="Foto de perfil">
            <input type="file" id="imageInput" accept="image/*">
        </div>
        <div class="profile-info">
            <p><strong>Nombre:</strong> <span id="nombreUsuario"></span></p>
            <p><strong>Username:</strong> <span id="usernameUsuario"></span>
                <button id="editUsernameBtn">Editar</button>
            </p>
            <p><strong>Contrase単a:</strong> <span id="contrasenaUsuario">********</span>
                <button id="editPasswordBtn">Editar</button>
            </p>
        </div>
        <button id="saveBtn">Guardar</button>
    </div>

    <script>
     function hashCode(str) {
    let hash = 0;
    for (let i = 0, len = str.length; i < len; i++) {
        let chr = str.charCodeAt(i);
        hash = (hash << 5) - hash + chr;
        hash |= 0; // Convert to 32bit integer
    }
    return hash;
}

document.addEventListener('DOMContentLoaded', function () {
    const usuarioActual = localStorage.getItem('usuarioActual');
    let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
    let usuario = null;

    if (usuarioActual) {
        usuario = usuarios.find(user => user.username === usuarioActual);
        if (usuario) {
            document.getElementById('welcomeMessage').textContent = `Bienvenido ${usuario.nombre}`;
            document.getElementById('nombreUsuario').textContent = usuario.nombre;
            document.getElementById('usernameUsuario').textContent = usuario.username;
            if (usuario.imagen) {
                document.getElementById('profileImage').src = usuario.imagen;
            }
        } else {
            window.location.href = 'login.html';
        }
    } else {
        window.location.href = 'login.html';
    }

    document.getElementById('logoutIcon').addEventListener('click', function () {
        localStorage.removeItem('usuarioActual');
        window.location.href = 'login.html';
    });

    document.getElementById('editUsernameBtn').addEventListener('click', function () {
        const newUsername = prompt('Ingrese el nuevo nombre de usuario:', usuario.username);
        if (newUsername) {
            usuario.username = newUsername;
            document.getElementById('usernameUsuario').textContent = newUsername;
            // Actualizar usuarioActual en el localStorage
            localStorage.setItem('usuarioActual', newUsername);
        }
    });

    document.getElementById('editPasswordBtn').addEventListener('click', function () {
        const newPassword = prompt('Ingrese la nueva contrase単a:');
        if (newPassword) {
            const hashedPassword = hashCode(newPassword).toString(); // Hashear la contrase単a
            usuario.contrasena = hashedPassword;
            alert('Contrase単a actualizada exitosamente.');
        }
    });

    document.getElementById('imageInput').addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profileImage').src = e.target.result;
                usuario.imagen = e.target.result; // Guardar la imagen en el usuario
            };
            reader.readAsDataURL(file);
        }
    });

    document.getElementById('saveBtn').addEventListener('click', function () {
        const usuarioIndex = usuarios.findIndex(user => user.username === usuarioActual);
        if (usuarioIndex > -1) {
            usuarios[usuarioIndex] = usuario;
        } else {
            const usuarioIndexNuevo = usuarios.findIndex(user => user.username === usuario.username);
            if (usuarioIndexNuevo > -1) {
                usuarios[usuarioIndexNuevo] = usuario;
                localStorage.setItem('usuarioActual', usuario.username);
            }
        }
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        alert('Datos guardados exitosamente.');
    });
});

    </script>
</body>
</html>